// Import Flutter framework р╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕гр╣Йр╕▓р╕З UI
import 'package:flutter/material.dart';

// Import р╕Ър╕гр╕┤р╕Бр╕▓р╕г authentication
import '../services/auth_service.dart';

/// ЁЯУЭ р╕лр╕Щр╣Йр╕▓р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б KU Planner
///
/// StatefulWidget р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Гр╕лр╕бр╣И
/// - р╣Бр╕кр╕Фр╕Зр╕Шр╕╡р╕б KU Planner р╕Юр╕гр╣Йр╕нр╕бр╣Вр╕ер╣Вр╕Бр╣Й
/// - р╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Кр╕╖р╣Ир╕н, р╕нр╕╡р╣Ар╕бр╕е, р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
/// - р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕Зр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
/// - р╣Ар╕гр╕╡р╕вр╕Б AuthService р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡р╣Гр╕лр╕бр╣И
/// - р╕Щр╕│р╕Чр╕▓р╕Зр╣Др╕Ыр╕лр╕Щр╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Ар╕бр╕╖р╣Ир╕нр╕кр╕│р╣Ар╕гр╣Зр╕И
class SignupPage extends StatefulWidget {
  const SignupPage({super.key});

  @override
  State<SignupPage> createState() => _SignupPageState();
}

class _SignupPageState extends State<SignupPage> {
  // Controllers р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕Щр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Б
  final nameCtrl = TextEditingController(); // р╕Хр╕▒р╕зр╕Др╕зр╕Ър╕Др╕╕р╕бр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕н
  final emailCtrl = TextEditingController(); // р╕Хр╕▒р╕зр╕Др╕зр╕Ър╕Др╕╕р╕бр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕нр╕╡р╣Ар╕бр╕е
  final passCtrl = TextEditingController(); // р╕Хр╕▒р╕зр╕Др╕зр╕Ър╕Др╕╕р╕бр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
  final confirmCtrl = TextEditingController(); // р╕Хр╕▒р╕зр╕Др╕зр╕Ър╕Др╕╕р╕бр╕Кр╣Ир╕нр╕Зр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ

  // Service р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕▓р╕гр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б
  final AuthService _authService = AuthService();

  // р╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф (р╣Бр╕кр╕Фр╕З loading indicator)
  bool _isLoading = false;

  /// ЁЯУЭ р╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б
  ///
  /// р╕гр╕▒р╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Бр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Бр╕ер╕░р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
  /// р╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡р╣Гр╕лр╕бр╣Ир╕Ьр╣Ир╕▓р╕Щ AuthService
  ///
  /// р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ:
  /// 1. р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Бр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╣Бр╕ер╕░р╕ер╕Ър╕Кр╣Ир╕нр╕Зр╕зр╣Ир╕▓р╕З
  /// 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
  /// 3. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Хр╕гр╕Зр╕Бр╕▒р╕Щ
  /// 4. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
  /// 5. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Лр╕▒р╕Ър╕Лр╣Йр╕нр╕Щр╕Вр╕нр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
  /// 6. р╣Ар╕гр╕╡р╕вр╕Б AuthService р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡
  /// 7. р╣Бр╕кр╕Фр╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╣Бр╕ер╕░р╕Щр╕│р╕Чр╕▓р╕Зр╣Др╕Ыр╕лр╕Щр╣Йр╕▓р╕Цр╕▒р╕Фр╣Др╕Ы
  void _signUp() async {
    // ЁЯУе р╕Фр╕╢р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Бр╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╣Бр╕ер╕░р╕ер╕Ър╕Кр╣Ир╕нр╕Зр╕зр╣Ир╕▓р╕Зр╕лр╕Щр╣Йр╕▓-р╕лр╕ер╕▒р╕З
    // trim() р╕Ир╕░р╕ер╕Ър╕Кр╣Ир╕нр╕Зр╕зр╣Ир╕▓р╕Зр╕Чр╕╡р╣Ир╕нр╕вр╕╣р╣Ир╕лр╕Щр╣Йр╕▓р╣Бр╕ер╕░р╕лр╕ер╕▒р╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕нр╕нр╕Б
    final name = nameCtrl.text.trim(); // р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
    final email = emailCtrl.text.trim(); // р╕нр╕╡р╣Ар╕бр╕е
    final pass = passCtrl.text.trim(); // р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
    final confirm = confirmCtrl.text.trim(); // р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ

    // тЬЕ р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 1: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щр╕Вр╕нр╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Др╕гр╕Ър╕Чр╕╕р╕Бр╕Кр╣Ир╕нр╕Зр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    // isEmpty р╕Ир╕░р╕Др╕╖р╕Щр╕Др╣Ир╕▓ true р╕Цр╣Йр╕▓р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Ар╕Ыр╣Зр╕Щр╕Др╣Ир╕▓р╕зр╣Ир╕▓р╕Зр╕лр╕гр╕╖р╕нр╕бр╕╡р╣Бр╕Хр╣Ир╕Кр╣Ир╕нр╕Зр╕зр╣Ир╕▓р╕З
    if (name.isEmpty || email.isEmpty || pass.isEmpty || confirm.isEmpty) {
      // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕кр╕╡р╣Бр╕Фр╕Зр╕Чр╕╡р╣Ир╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕Зр╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓р╕Ир╕н
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text("р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Чр╕╕р╕Бр╕Кр╣Ир╕нр╕З"),
          backgroundColor: Colors.red, // р╕кр╕╡р╣Бр╕Фр╕Зр╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф
        ),
      );
      return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡ р╣Др╕бр╣Ир╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕гр╕Хр╣Ир╕н
    }

    // тЬЕ р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 2: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Хр╕гр╕Зр╕Бр╕▒р╕Щ
    // р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ър╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Чр╕╡р╣Ир╕Бр╕гр╕нр╕Бр╕Бр╕▒р╕Ър╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Чр╕╡р╣Ир╕вр╕╖р╕Щр╕вр╕▒р╕Щ
    // р╕Хр╣Йр╕нр╕Зр╕Хр╕гр╕Зр╕Бр╕▒р╕Щр╕Чр╕╕р╕Бр╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕гр╣Ар╕Юр╕╖р╣Ир╕нр╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╕Юр╕┤р╕бр╕Юр╣Мр╕Ьр╕┤р╕Ф
    if (pass != confirm) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text("р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Др╕бр╣Ир╕Хр╕гр╕Зр╕Бр╕▒р╕Щ"),
          backgroundColor: Colors.red,
        ),
      );
      return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡
    }

    // тЬЕ р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 3: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕Вр╕нр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
    // р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 6 р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕гр╣Ар╕Юр╕╖р╣Ир╕нр╕Др╕зр╕▓р╕бр╕Ыр╕ер╕нр╕Фр╕ар╕▒р╕в
    // length р╕Ир╕░р╕Др╕╖р╕Щр╕Др╣Ир╕▓р╕Ир╕│р╕Щр╕зр╕Щр╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕гр╣Гр╕Щр╕кр╕Хр╕гр╕┤р╕З
    if (pass.length < 6) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text("р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 6 р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г"),
          backgroundColor: Colors.red,
        ),
      );
      return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡
    }

    // тЬЕ р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 4: р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕зр╕▓р╕бр╕Лр╕▒р╕Ър╕Лр╣Йр╕нр╕Щр╕Вр╕нр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
    // р╣Гр╕Кр╣Й Regular Expression (RegExp) р╣Ар╕Юр╕╖р╣Ир╕нр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
    //
    // р╕нр╕Шр╕┤р╕Ър╕▓р╕в Regex Pattern:
    // ^ = р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щр╕кр╕Хр╕гр╕┤р╕З
    // (?=.*[A-Z]) = р╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕Хр╕▒р╕зр╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕лр╕Нр╣Ир╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕Хр╕▒р╕з (Positive Lookahead)
    // (?=.*[!@#\$%^&*()_+\-=\[\]{};:"\\|,.<>\/?]) = р╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕нр╕▒р╕Бр╕Вр╕гр╕░р╕Юр╕┤р╣Ар╕ир╕йр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕Хр╕▒р╕з
    // [A-Za-z0-9!@#\$%^&*()_+\-=\[\]{};:"\\|,.<>\/?]{6,} = р╕нр╕Щр╕╕р╕Нр╕▓р╕Хр╣Ар╕Йр╕Юр╕▓р╕░р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕г, р╕Хр╕▒р╕зр╣Ар╕ер╕В, р╣Бр╕ер╕░р╕нр╕▒р╕Бр╕Вр╕гр╕░р╕Юр╕┤р╣Ар╕ир╕й р╕Др╕зр╕▓р╕бр╕вр╕▓р╕зр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 6 р╕Хр╕▒р╕з
    // $ = р╕кр╕┤р╣Йр╕Щр╕кр╕╕р╕Фр╕кр╕Хр╕гр╕┤р╕З
    final RegExp passRegex = RegExp(
      r'^(?=.*[A-Z])(?=.*[!@#\$%^&*()_+\-=\[\]{};:"\\|,.<>\/?])[A-Za-z0-9!@#\$%^&*()_+\-=\[\]{};:"\\|,.<>\/?]{6,}$',
    );

    // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Хр╕гр╕Зр╕Хр╕▓р╕бр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Чр╕╡р╣Ир╕Бр╕│р╕лр╕Щр╕Фр╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    if (!passRegex.hasMatch(pass)) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text(
            "р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Хр╣Йр╕нр╕Зр╕бр╕╡р╕Хр╕▒р╕зр╕Юр╕┤р╕бр╕Юр╣Мр╣Гр╕лр╕Нр╣Ир╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕Хр╕▒р╕з р╣Бр╕ер╕░р╕нр╕▒р╕Бр╕Вр╕гр╕░р╕Юр╕┤р╣Ар╕ир╕йр╕нр╕вр╣Ир╕▓р╕Зр╕Щр╣Йр╕нр╕в 1 р╕Хр╕▒р╕з",
          ),
          backgroundColor: Colors.red,
        ),
      );
      return; // р╕лр╕вр╕╕р╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Чр╕▒р╕Щр╕Чр╕╡
    }

    // ЁЯФД р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 5: р╣Бр╕кр╕Фр╕З Loading Indicator
    // р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕░ _isLoading р╣Ар╕Ыр╣Зр╕Щ true р╣Ар╕Юр╕╖р╣Ир╕нр╣Бр╕кр╕Фр╕Зр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф
    // setState() р╕Ир╕░р╕Чр╕│р╣Гр╕лр╣Й UI р╕нр╕▒р╕Ыр╣Ар╕Фр╕Хр╣Гр╕лр╕бр╣И (р╕Ыр╕╕р╣Ир╕бр╕Ир╕░р╣Бр╕кр╕Фр╕З loading)
    setState(() {
      _isLoading = true;
    });

    // ЁЯФД р╕Вр╕▒р╣Йр╕Щр╕Хр╕нр╕Щр╕Чр╕╡р╣И 6: р╣Ар╕гр╕╡р╕вр╕Б AuthService р╣Ар╕Юр╕╖р╣Ир╕нр╕кр╕гр╣Йр╕▓р╕Зр╕Ър╕▒р╕Нр╕Кр╕╡
    // р╣Гр╕Кр╣Й try-catch р╣Ар╕Юр╕╖р╣Ир╕нр╕Ир╕▒р╕Фр╕Бр╕▓р╕гр╕Бр╕▒р╕Ъ error р╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╣Ар╕Бр╕┤р╕Фр╕Вр╕╢р╣Йр╕Щ
    try {
      // р╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ register р╕Ир╕▓р╕Б AuthService
      // await р╕Ир╕░р╕гр╕нр╣Гр╕лр╣Йр╕Бр╕▓р╕гр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Ар╕кр╕гр╣Зр╕Ир╕кр╕┤р╣Йр╕Щр╕Бр╣Ир╕нр╕Щр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕гр╕Хр╣Ир╕н
      final success = await _authService.register(name, email, pass);

      // тЬЕ р╕Бр╕гр╕Ур╕╡р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И
      if (success) {
        // р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ widget р╕вр╕▒р╕Зр╕Др╕Зр╕нр╕вр╕╣р╣Ир╣Гр╕Щр╕лр╕Щр╣Йр╕▓р╕Ир╕нр╕лр╕гр╕╖р╕нр╣Др╕бр╣И (mounted)
        // р╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕З SnackBar р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕Чр╕╡р╣Ир╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕лр╕Щр╣Йр╕▓р╣Бр╕ер╣Йр╕з
        if (mounted) {
          // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕Ир╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕з
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text("р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╕кр╕│р╣Ар╕гр╣Зр╕И! ЁЯОЙ"),
              backgroundColor: Colors.green, // р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╣Бр╕кр╕Фр╕Зр╕Др╕зр╕▓р╕бр╕кр╕│р╣Ар╕гр╣Зр╕И
            ),
          );
          // р╕Щр╕│р╕Чр╕▓р╕Зр╣Др╕Ыр╕лр╕Щр╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
          // pushReplacementNamed р╕Ир╕░р╣Бр╕Чр╕Щр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Фр╣Йр╕зр╕вр╕лр╕Щр╣Йр╕▓р╣Гр╕лр╕бр╣И
          Navigator.pushReplacementNamed(context, '/login');
        }
      }
      // тЭМ р╕Бр╕гр╕Ур╕╡р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И (р╕нр╕╡р╣Ар╕бр╕ер╕Цр╕╣р╕Бр╣Гр╕Кр╣Йр╣Бр╕ер╣Йр╕з)
      else {
        if (mounted) {
          // р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╕кр╕╡р╣Бр╕Фр╕З
          ScaffoldMessenger.of(context).showSnackBar(
            const SnackBar(
              content: Text("р╕нр╕╡р╣Ар╕бр╕ер╕Щр╕╡р╣Йр╕Цр╕╣р╕Бр╣Гр╕Кр╣Йр╣Бр╕ер╣Йр╕з р╕Бр╕гр╕╕р╕Ур╕▓р╣Гр╕Кр╣Йр╕нр╕╡р╣Ар╕бр╕ер╕нр╕╖р╣Ир╕Щ"),
              backgroundColor: Colors.red,
            ),
          );
        }
      }
    }
    // ЁЯЪи р╕Ир╕▒р╕Фр╕Бр╕▓р╕г error р╕Чр╕╡р╣Ир╕нр╕▓р╕Ир╣Ар╕Бр╕┤р╕Фр╕Вр╕╢р╣Йр╕Щр╕гр╕░р╕лр╕зр╣Ир╕▓р╕Зр╕Бр╕▓р╕гр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б
    catch (e) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text("р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф: $e"), // р╣Бр╕кр╕Фр╕З error message
            backgroundColor: Colors.red,
          ),
        );
      }
    }
    // ЁЯз╣ р╕Чр╕│р╕Др╕зр╕▓р╕бр╕кр╕░р╕нр╕▓р╕Фр╣Ар╕кр╕бр╕н (р╕Лр╣Ир╕нр╕Щ loading indicator)
    // finally р╕Ир╕░р╕Чр╕│р╕Зр╕▓р╕Щр╣Ар╕кр╕бр╕н р╣Др╕бр╣Ир╕зр╣Ир╕▓р╕Ир╕░р╕бр╕╡ error р╕лр╕гр╕╖р╕нр╣Др╕бр╣И
    finally {
      if (mounted) {
        // р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕кр╕Цр╕▓р╕Щр╕░ _isLoading р╣Ар╕Ыр╣Зр╕Щ false р╣Ар╕Юр╕╖р╣Ир╕нр╕Лр╣Ир╕нр╕Щр╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф
        setState(() {
          _isLoading = false;
        });
      }
    }
  }

  /// ЁЯОи р╕кр╕гр╣Йр╕▓р╕З UI р╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б KU Planner
  ///
  /// Widget build() р╕Ир╕░р╕Цр╕╣р╕Бр╣Ар╕гр╕╡р╕вр╕Бр╣Ар╕бр╕╖р╣Ир╕нр╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕З UI
  /// р╣Гр╕Кр╣Й Scaffold р╣Ар╕Ыр╣Зр╕Щр╣Вр╕Др╕гр╕Зр╕кр╕гр╣Йр╕▓р╕Зр╕лр╕ер╕▒р╕Бр╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓
  /// р╕Ыр╕гр╕░р╕Бр╕нр╕Ър╕Фр╣Йр╕зр╕в:
  /// - р╣Вр╕ер╣Вр╕Бр╣Й KU р╣Бр╕ер╕░ PLANER
  /// - р╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕е (р╕Кр╕╖р╣Ир╕н, р╕нр╕╡р╣Ар╕бр╕е, р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ, р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ)
  /// - р╕Ыр╕╕р╣Ир╕бр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б (р╕Юр╕гр╣Йр╕нр╕б loading indicator)
  /// - р╕Ыр╕╕р╣Ир╕бр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      // ЁЯОи р╕Бр╕│р╕лр╕Щр╕Фр╕кр╕╡р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╣Ар╕Ыр╣Зр╕Щр╕кр╕╡р╕Вр╕▓р╕з
      backgroundColor: const Color.fromARGB(
        255, // Alpha (р╕Др╕зр╕▓р╕бр╣Вр╕Ыр╕гр╣Ир╕Зр╣Гр╕к) = 255 (р╕Чр╕╢р╕Ър╣Бр╕кр╕З)
        255, // Red = 255
        255, // Green = 255
        255, // Blue = 255
      ), // р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М: р╕кр╕╡р╕Вр╕▓р╕зр╕Чр╕╢р╕Ър╣Бр╕кр╕З
      body: Center(
        // ЁЯУР р╕Ир╕▒р╕Фр╣Гр╕лр╣Йр╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓р╕нр╕вр╕╣р╣Ир╕Хр╕гр╕Зр╕Бр╕ер╕▓р╕Зр╕лр╕Щр╣Йр╕▓р╕Ир╕н
        child: Padding(
          padding: const EdgeInsets.all(
            20.0,
          ), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕Зр╕Ир╕▓р╕Бр╕Вр╕нр╕Ър╕Чр╕╕р╕Бр╕Фр╣Йр╕▓р╕Щ 20 pixels
          child: Column(
            mainAxisSize: MainAxisSize.min, // р╣Гр╕Кр╣Йр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕Щр╣Йр╕нр╕вр╕Чр╕╡р╣Ир╕кр╕╕р╕Фр╕Хр╕▓р╕бр╣Ар╕Щр╕╖р╣Йр╕нр╕лр╕▓
            children: [
              // ЁЯОи р╣Вр╕ер╣Вр╕Бр╣Й KU - р╕Хр╕▒р╕зр╕нр╕▒р╕Бр╕йр╕гр╕Вр╕Щр╕▓р╕Фр╣Гр╕лр╕Нр╣И
              const Text(
                "KU",
                style: TextStyle(
                  fontSize: 170, // р╕Вр╕Щр╕▓р╕Фр╕Яр╕нр╕Щр╕Хр╣М 170
                  fontWeight: FontWeight.bold, // р╕Хр╕▒р╕зр╕лр╕Щр╕▓
                  color: Color(0xff006866), // р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╣Ар╕Вр╣Йр╕б KU
                  height: 0.9, // р╕Др╕зр╕▓р╕бр╕кр╕╣р╕Зр╕Вр╕нр╕Зр╕Ър╕гр╕гр╕Чр╕▒р╕Ф
                ),
              ),
              const SizedBox(height: 10), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 10 pixels
              // ЁЯУП р╣Бр╕Цр╕Ър╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╕нр╣Ир╕нр╕Щ KU
              Container(
                width: 230, // р╕Бр╕зр╣Йр╕▓р╕З 230 pixels
                height: 30, // р╕кр╕╣р╕З 30 pixels
                color: const Color(0xffb2bb1f), // р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╕нр╣Ир╕нр╕Щ KU
              ),
              const SizedBox(height: 10), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 10 pixels
              // ЁЯП╖я╕П р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б "PLANER"
              const Text(
                "PLANER",
                style: TextStyle(
                  fontSize: 30, // р╕Вр╕Щр╕▓р╕Фр╕Яр╕нр╕Щр╕Хр╣М 30
                  fontWeight: FontWeight.w900, // р╕Хр╕▒р╕зр╕лр╕Щр╕▓р╕бр╕▓р╕Б
                  color: Color(0xff006866), // р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╣Ар╕Вр╣Йр╕б KU
                ),
              ),
              const SizedBox(height: 24), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 24 pixels
              // ЁЯСд р╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕н
              TextField(
                controller: nameCtrl, // р╣Гр╕Кр╣Й controller р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Др╕зр╣Й
                decoration: InputDecoration(
                  labelText: "Name", // р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╣Гр╕Щ label
                  border: OutlineInputBorder(
                    borderRadius: BorderRadius.circular(50), // р╕бр╕╕р╕бр╣Вр╕Др╣Йр╕Зр╕бр╕Щ 50
                  ),
                ),
              ),
              const SizedBox(height: 24), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 24 pixels
              // ЁЯУз р╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕нр╕╡р╣Ар╕бр╕е
              TextField(
                controller: emailCtrl, // р╣Гр╕Кр╣Й controller р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Др╕зр╣Й
                decoration: InputDecoration(
                  labelText: "Enter Email", // р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╣Гр╕Щ label
                  border: OutlineInputBorder(
                    borderRadius: BorderRadius.circular(50), // р╕бр╕╕р╕бр╣Вр╕Др╣Йр╕Зр╕бр╕Щ 50
                  ),
                ),
              ),
              const SizedBox(height: 24), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 24 pixels
              // ЁЯФТ р╕Кр╣Ир╕нр╕Зр╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
              TextField(
                controller: passCtrl, // р╣Гр╕Кр╣Й controller р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Др╕зр╣Й
                obscureText: true, // р╕Лр╣Ир╕нр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б (р╣Бр╕кр╕Фр╕Зр╣Ар╕Ыр╣Зр╕Щ dots)
                decoration: InputDecoration(
                  labelText: "Enter Password", // р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╣Гр╕Щ label
                  border: OutlineInputBorder(
                    borderRadius: BorderRadius.circular(50), // р╕бр╕╕р╕бр╣Вр╕Др╣Йр╕Зр╕бр╕Щ 50
                  ),
                ),
              ),
              const SizedBox(height: 24), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 24 pixels
              // ЁЯФР р╕Кр╣Ир╕нр╕Зр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
              TextField(
                controller: confirmCtrl, // р╣Гр╕Кр╣Й controller р╕Чр╕╡р╣Ир╕кр╕гр╣Йр╕▓р╕Зр╣Др╕зр╣Й
                obscureText: true, // р╕Лр╣Ир╕нр╕Щр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б (р╣Бр╕кр╕Фр╕Зр╣Ар╕Ыр╣Зр╕Щ dots)
                decoration: InputDecoration(
                  labelText: "Confirm Password", // р╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╣Гр╕Щ label
                  border: OutlineInputBorder(
                    borderRadius: BorderRadius.circular(50), // р╕бр╕╕р╕бр╣Вр╕Др╣Йр╕Зр╕бр╕Щ 50
                  ),
                ),
              ),
              const SizedBox(height: 24), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 24 pixels
              // ЁЯУЭ р╕Ыр╕╕р╣Ир╕бр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б - р╕Ыр╕╕р╣Ир╕бр╕лр╕ер╕▒р╕Бр╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓
              ElevatedButton(
                // р╕Цр╣Йр╕▓р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Ф (_isLoading = true) р╣Гр╕лр╣Йр╕Ыр╕╕р╣Ир╕бр╣Др╕бр╣Ир╕кр╕▓р╕бр╕▓р╕гр╕Цр╕Бр╕Фр╣Др╕Фр╣Й (null)
                // р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╣Вр╕лр╕ер╕Ф (_isLoading = false) р╣Гр╕лр╣Йр╣Ар╕гр╕╡р╕вр╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ _signUp
                onPressed: _isLoading ? null : _signUp,
                style: ElevatedButton.styleFrom(
                  backgroundColor: const Color(
                    0xff006866,
                  ), // р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╣Ар╕Вр╣Йр╕б KU (#006866)
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(
                      50,
                    ), // р╕бр╕╕р╕бр╣Вр╕Др╣Йр╕Зр╕бр╕Щ 50 pixels
                  ),
                  padding: const EdgeInsets.symmetric(
                    horizontal: 150, // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕Зр╕Лр╣Йр╕▓р╕в-р╕Вр╕зр╕▓ 150 pixels
                    vertical: 14, // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕Зр╕Ър╕Щ-р╕ер╣Ир╕▓р╕З 14 pixels
                  ),
                ),
                child: _isLoading
                    ? // ЁЯФД р╣Бр╕кр╕Фр╕З loading indicator р╕Вр╕Ур╕░р╕Ыр╕гр╕░р╕бр╕зр╕ер╕Ьр╕е
                      const Row(
                        mainAxisSize: MainAxisSize.min, // р╣Гр╕Кр╣Йр╕Юр╕╖р╣Йр╕Щр╕Чр╕╡р╣Ир╕Щр╣Йр╕нр╕вр╕Чр╕╡р╣Ир╕кр╕╕р╕Ф
                        children: [
                          SizedBox(
                            width: 16, // р╕Бр╕зр╣Йр╕▓р╕З 16 pixels
                            height: 16, // р╕кр╕╣р╕З 16 pixels
                            child: CircularProgressIndicator(
                              strokeWidth:
                                  2, // р╕Др╕зр╕▓р╕бр╕лр╕Щр╕▓р╕Вр╕нр╕Зр╕зр╕Зр╕Бр╕ер╕б loading 2 pixels
                              valueColor: AlwaysStoppedAnimation<Color>(
                                Colors.white, // р╕кр╕╡р╕Вр╕▓р╕з
                              ),
                            ),
                          ),
                          SizedBox(
                            width: 8,
                          ), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕Зр╕гр╕░р╕лр╕зр╣Ир╕▓р╕З loading р╕Бр╕▒р╕Ър╕Вр╣Йр╕нр╕Др╕зр╕▓р╕б 8 pixels
                          Text(
                            "р╕Бр╕│р╕ер╕▒р╕Зр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б...",
                            style: TextStyle(fontSize: 15, color: Colors.white),
                          ),
                        ],
                      )
                    : // ЁЯУЭ р╣Бр╕кр╕Фр╕Зр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╕Ыр╕Бр╕Хр╕┤р╣Ар╕бр╕╖р╣Ир╕нр╣Др╕бр╣Ир╣Вр╕лр╕ер╕Ф
                      const Text(
                        "SIGN UP",
                        style: TextStyle(fontSize: 15, color: Colors.white),
                      ),
              ),
              const SizedBox(height: 24), // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕З 24 pixels
              // ЁЯФЧ р╕Ыр╕╕р╣Ир╕бр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ - р╕Ыр╕╕р╣Ир╕бр╕гр╕нр╕Зр╕кр╕│р╕лр╕гр╕▒р╕Ър╕Ьр╕╣р╣Йр╕Чр╕╡р╣Ир╕бр╕╡р╕Ър╕▒р╕Нр╕Кр╕╡р╣Бр╕ер╣Йр╕з
              ElevatedButton(
                onPressed: () {
                  // р╕Щр╕│р╕Чр╕▓р╕Зр╣Др╕Ыр╕лр╕Щр╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
                  // pushReplacementNamed р╕Ир╕░р╣Бр╕Чр╕Щр╕Чр╕╡р╣Ир╕лр╕Щр╣Йр╕▓р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щр╕Фр╣Йр╕зр╕вр╕лр╕Щр╣Йр╕▓р╣Гр╕лр╕бр╣И
                  Navigator.pushReplacementNamed(
                    context,
                    '/login', // р╕Кр╕╖р╣Ир╕н route р╕Вр╕нр╕Зр╕лр╕Щр╣Йр╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
                  );
                },
                style: ElevatedButton.styleFrom(
                  backgroundColor: const Color.fromARGB(
                    255, // Alpha = 255 (р╕Чр╕╢р╕Ър╣Бр╕кр╕З)
                    255, // Red = 255
                    255, // Green = 255
                    255, // Blue = 255
                  ), // р╕кр╕╡р╕Вр╕▓р╕з (р╕Юр╕╖р╣Йр╕Щр╕лр╕ер╕▒р╕Зр╕Вр╕нр╕Зр╕Ыр╕╕р╣Ир╕б)
                  shape: RoundedRectangleBorder(
                    borderRadius: BorderRadius.circular(
                      50,
                    ), // р╕бр╕╕р╕бр╣Вр╕Др╣Йр╕Зр╕бр╕Щ 50 pixels
                  ),
                  padding: const EdgeInsets.symmetric(
                    horizontal: 150, // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕Зр╕Лр╣Йр╕▓р╕в-р╕Вр╕зр╕▓ 150 pixels
                    vertical: 14, // р╕гр╕░р╕вр╕░р╕лр╣Ир╕▓р╕Зр╕Ър╕Щ-р╕ер╣Ир╕▓р╕З 14 pixels
                  ),
                ),
                child: const Text(
                  "SIGN IN",
                  style: TextStyle(
                    fontSize: 15,
                    color: Color(0xff006866), // р╕кр╕╡р╣Ар╕Вр╕╡р╕вр╕зр╣Ар╕Вр╣Йр╕б KU (#006866)
                  ),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
